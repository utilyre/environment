#!/bin/sh

function main() {
	name="$(basename "$PWD")"
	if ! tmux has-session -t "$name" 2> "/dev/null"; then
		tx_new "$name"
	fi

	tx_open "$name"
}

function tx_open() {
	if [ "$TMUX" ]; then
		tmux switch-client -t "$1"
	else
		tmux attach-session -t "$1"
	fi
}

function tx_new() {
	tmux new-session -d -s "$1" -n "code"
	tmux new-window -t "$1:2" -n "view"
	tmux new-window -t "$1:3" -n "misc"
	tmux split-window -t "$1:3"
	tmux split-window -h -t "$1:3"
	tmux select-pane -t "$1:3.1"
	tmux select-window -t "$1:2"
	tmux select-window -t "$1:1"
}

main
