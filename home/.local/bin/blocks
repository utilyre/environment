#!/bin/sh

title="$(swaymsg -t get_tree | jq -r '.. | select(.focused? == true) | .name')"

do=true
swaymsg -mt subscribe '["window"]' | while "$do" || read -rt1 event || true; do
  do=false

  if [ "$event" ]; then
    title="$(printf "%s\n" "$event" | jq -r .container.name)"
  fi
  layout="$(swaymsg -t get_inputs | jq -r 'map(select(has("xkb_active_layout_name")))[0].xkb_active_layout_name')"
  case "$layout" in
    "English (US)") layout=En ;;
    "Persian") layout=Fa ;;
  esac
  batcap="$(cat /sys/class/power_supply/BAT0/capacity)"
  batstatus="$(tr "[:upper:]" "[:lower:]" < /sys/class/power_supply/BAT0/status)"
	date="$(date +"%a, %b %-d %H:%M")"

	printf "%s    %s    %s%% %s    %s \n" "$title" "$layout" "$batcap" "$batstatus" "$date"
done
