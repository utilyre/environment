#!/bin/sh

path="$(realpath -- "${1:-"$PWD"}")"
name="$(printf '%s' "${2:-"$(basename -- "$path")"}" | tr -c '[:alnum:]_-' '_')"

if tmux new-session -dc "$path" -s "$name" 2> /dev/null; then
	tmux send-keys -t "$name:1" hx Enter
	tmux new-window -dt "$name" -c "$path" lazygit
	tmux new-window -dt "$name" -c "$path" sleep infinity
	tmux set-option -wt "$name:3" remain-on-exit on
fi

if [ "$TMUX" ]; then
	tmux switch-client -t "$name"
else
	tmux attach-session -t "$name"
fi
