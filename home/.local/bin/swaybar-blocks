#!/bin/sh

# ignore USR1 signals
trap : USR1

while true; do
	keyboard=none
	case "$(swaymsg -t get_inputs | jq -r 'map(select(has("xkb_active_layout_name")))[0].xkb_active_layout_name')" in
		"English (US)") keyboard=en ;;
		"Persian") keyboard=fa ;;
	esac

	battery="$(cat /sys/class/power_supply/BAT0/capacity)%"
	if [ "$(cat /sys/class/power_supply/BAT0/status)" = Charging ]; then
		battery="^$battery"
	fi

	datetime="$(date +'%a %-d %b %H:%M')"

	printf '%s    %s    %s   \n' "$keyboard" "$battery" "$datetime"

	sleep 10 &
	# an ignored USR1 signal stops the wait
	wait -- "$!"
done
